#!/usr/bin/env bash

display_usage() {
  echo "dot -- dotfiles maintenance"
  echo ""
  echo "Usage: dot [options]"
  echo ""
  echo "Options:"
  echo "  -e, --edit    Open the dotfiles directory in an editor"
  echo "  -h, --help    Show this help message and exit"
  echo "  -d, --dump    Update lists of installed packages"
  echo "  -c, --chmod   Fix file permissions in the dotfiles repository"
}

if [[ $# > 0 ]]; then
  case "$1" in
    "-h"|"--help")
      display_usage
      ;;
    "-e"|"--edit")
      e "$DOTFILES"
      ;;
    "-d"|"--dump")
      brew bundle dump --force --file="$DOTFILES/topics/brew/Brewfile"
      [[ $(which code) ]] && code --list-extensions > "$DOTFILES/topics/code/extensions.txt"
      ;;
    "-c"|"--chmod")
      find "$DOTFILES/binaries" -type f -exec chmod +x {} \;
      find "$DOTFILES/topics" -iname "*.zsh" -or -iname "*.sh" -exec chmod +x {} \;
      find "$DOTFILES/topics" -iname "*hook*" -exec chmod +x {} \;
      ;;
    *)
      echo "Invalid option: $1"
      display_usage
      ;;
  esac
  exit
fi

eval "$DOTFILES/init.sh"
